<!DOCTYPE html>
<html>
<head>
  <title>Test Backend Login</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
    }
    button {
      background: #0070f3;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
      margin: 5px;
    }
    button:hover {
      background: #0051cc;
    }
    pre {
      background: #f4f4f4;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
    }
    .success { color: green; }
    .error { color: red; }
    .info { color: blue; }
  </style>
</head>
<body>
  <h1>üß™ Backend Test Suite</h1>
  <p>Test backend endpoints directly without Next.js cache</p>

  <h2>1. Test Backend Health</h2>
  <button onclick="testHealth()">Check Backend Status</button>
  
  <h2>2. Test Login Endpoint</h2>
  <button onclick="testLogin()">Test /auth/login (404 Expected)</button>
  
  <h2>3. Test Signup Flow</h2>
  <button onclick="testSignupInit()">Test /auth/signup/init</button>
  <button onclick="testSignupPassword()">Test /auth/signup/password</button>
  <button onclick="testSignupVerify()">Test /auth/signup/verify</button>
  
  <h2>4. Debug Info</h2>
  <button onclick="showDebugInfo()">Show Session Storage</button>
  <button onclick="clearSession()">Clear Session Storage</button>
  
  <h2>Results:</h2>
  <pre id="result">Click a test button above...</pre>

  <script>
    const API_URL = 'http://localhost:8000';
    
    function log(message, type = 'info') {
      const result = document.getElementById('result');
      const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
      result.innerHTML = `<span class="${className}">${message}</span>`;
    }
    
    async function testHealth() {
      try {
        const response = await fetch(`${API_URL}/health`);
        const data = await response.json();
        
        log(`‚úÖ Backend is ONLINE
Status: ${response.status}
Response: ${JSON.stringify(data, null, 2)}`, 'success');
      } catch (error) {
        log(`‚ùå Backend is OFFLINE
Error: ${error.message}`, 'error');
      }
    }
    
    async function testLogin() {
      try {
        const response = await fetch(`${API_URL}/api/v1/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({
            email: 'test@example.com',
            password: 'TestPassword123'
          })
        });
        
        const data = await response.json();
        
        if (response.status === 404) {
          log(`‚úÖ Login endpoint is WORKING!
Status: 404 (Expected for non-existent user)
Response: ${JSON.stringify(data, null, 2)}

This is CORRECT! Backend is working.`, 'success');
        } else {
          log(`Status: ${response.status}
Response: ${JSON.stringify(data, null, 2)}`, 'info');
        }
      } catch (error) {
        log(`‚ùå Error: ${error.message}`, 'error');
      }
    }
    
    async function testSignupInit() {
      const email = prompt('Enter test email:', 'test@example.com');
      if (!email) return;
      
      try {
        const response = await fetch(`${API_URL}/api/v1/auth/signup/init`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });
        
        const data = await response.json();
        
        log(`Status: ${response.status}
Request: {"email": "${email}"}
Response: ${JSON.stringify(data, null, 2)}`, 
          response.ok ? 'success' : 'error');
      } catch (error) {
        log(`‚ùå Error: ${error.message}`, 'error');
      }
    }
    
    async function testSignupPassword() {
      const email = prompt('Enter email:', sessionStorage.getItem('signup_email') || 'test@example.com');
      const password = prompt('Enter password:', 'Test1234');
      if (!email || !password) return;
      
      try {
        const response = await fetch(`${API_URL}/api/v1/auth/signup/password`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        
        const data = await response.json();
        
        log(`Status: ${response.status}
Request: {"email": "${email}", "password": "***"}
Response: ${JSON.stringify(data, null, 2)}

${response.ok ? '‚úÖ Check email for verification code!' : ''}`, 
          response.ok ? 'success' : 'error');
      } catch (error) {
        log(`‚ùå Error: ${error.message}`, 'error');
      }
    }
    
    async function testSignupVerify() {
      const email = prompt('Enter email:', sessionStorage.getItem('signup_email') || '');
      const code = prompt('Enter 6-digit code from email:');
      if (!email || !code) return;
      
      try {
        const response = await fetch(`${API_URL}/api/v1/auth/signup/verify`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, code })
        });
        
        const data = await response.json();
        
        log(`Status: ${response.status}
Request: {"email": "${email}", "code": "${code}"}
Response: ${JSON.stringify(data, null, 2)}`, 
          response.ok ? 'success' : 'error');
      } catch (error) {
        log(`‚ùå Error: ${error.message}`, 'error');
      }
    }
    
    function showDebugInfo() {
      const info = {
        'signup_email': sessionStorage.getItem('signup_email'),
        'signup_password': sessionStorage.getItem('signup_password') ? '***HIDDEN***' : null,
        'signup_temp_token': sessionStorage.getItem('signup_temp_token') ? '***EXISTS***' : null
      };
      
      log(`üìã Session Storage Contents:
${JSON.stringify(info, null, 2)}

API Base URL: ${API_URL}
Current Page: ${window.location.href}`, 'info');
    }
    
    function clearSession() {
      sessionStorage.clear();
      log('‚úÖ Session storage cleared!', 'success');
    }
  </script>
</body>
</html>
